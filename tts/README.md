# sherpa-onnx TTS (plain JS)

WebAssembly-pow## üá∏üá™ Local Swedish models

English voices live inside the `.data` bundle that ships with sherpa-onnx. Swedish voices are larger, so we mount them lazily from the `models/` directory. A small `manifest.json` file (generated by a helper script) lists every file that needs to appear in the in-memory filesystem. When a Swedish voice is selected, `main.js` mounts the model files, constructs the config, and spins up a new TTS instance ‚Äî no page reload required.

The Swedish models share a common `espeak-ng-data` directory (mounted once from Lisa) to avoid duplicating ~80MB of pronunciation data. The NST model references Lisa's espeak data via `sharedDataDir` and auto-mount dependencies, so selecting either Swedish voice triggers the correct loading order.

To add another local model:

1. Download and extract the model files under `tts/models/<model-name>/`.
2. Regenerate `manifest.json` so that each file path is enumerated (the Node script we used simply walks the directory and writes relative paths).
3. Register the model in `MODEL_DEFINITIONS` inside `main.js` and add at least one entry to `window.SHERPA_TTS_SPEAKERS` with the matching `modelId`.
4. If the new model uses shared pronunciation data, specify `sharedDataDir` and `mountDependencies` to avoid duplicating large espeak directories. to speech that runs entirely in your browser. The page loads the official `sherpa-onnx` WebAssembly build (v1.12.15, SIMD) and exposes a friendly UI for generating and downloading speech clips.

## ‚ú® Features

- No build step ‚Äî plain HTML/CSS/JS.
- Ships the sherpa-onnx offline TTS WASM bundle (LibriTTS-R, English) and mounts extra Swedish VITS models on demand.
- Language and voice pickers with friendly names (auto-fallback if metadata is missing).
- Plays the result immediately and lets you download WAV files.
- All processing happens locally; no network requests after the initial page load.

## üìÇ Project Structure

```
tts/
‚îú‚îÄ‚îÄ index.html               # UI markup & script loading order
‚îú‚îÄ‚îÄ main.js                  # Front-end logic & sherpa-onnx integration
‚îú‚îÄ‚îÄ style.css                # Frosted glass UI styling
‚îú‚îÄ‚îÄ models/                  # Local VITS models + manifest for lazy mounting
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json        # Generated list of files to mount in the Emscripten FS
‚îÇ   ‚îú‚îÄ‚îÄ vits-piper-sv_SE-lisa-medium/
‚îÇ   ‚îî‚îÄ‚îÄ vits-piper-sv_SE-nst-medium/
‚îî‚îÄ‚îÄ vendor/                  # sherpa-onnx assets (JS + WASM + .data)
```

## üß™ Local preview

The app works when opened from disk, but using a local HTTP server avoids CORS issues in some browsers and makes the large `.data` file stream correctly.

```bash
# From the repository root
python3 -m http.server 8080
```

Then visit [http://localhost:8080/tts/](http://localhost:8080/tts/).

> **Tip:** The first load fetches ~90&nbsp;MB of model data. After it finishes, everything runs offline.

## üîÑ Updating the sherpa bundle

1. Download the latest release from the [sherpa-onnx WebAssembly TTS package](https://github.com/k2-fsa/sherpa-onnx/releases).
2. Replace the files in `vendor/` with the new `sherpa-onnx-tts.js`, `sherpa-onnx-wasm-main-tts.js`, `.wasm`, and `.data` files.
3. Update `main.js` if the factory method signature changes.

## ÔøΩüá™ Local Swedish models

English voices live inside the `.data` bundle that ships with sherpa-onnx. Swedish voices are larger, so we mount them lazily from the `models/` directory. A small `manifest.json` file (generated by a helper script) lists every file that needs to appear in the in-memory filesystem. When a Swedish voice is selected, `main.js` mounts the model files, constructs the config, and spins up a new TTS instance ‚Äî no page reload required.

To add another local model:

1. Download and extract the model files under `tts/models/<model-name>/`.
2. Regenerate `manifest.json` so that each file path is enumerated (the Node script we used simply walks the directory and writes relative paths).
3. Register the model in `MODEL_DEFINITIONS` inside `main.js` and add at least one entry to `window.SHERPA_TTS_SPEAKERS` with the matching `modelId`.

> **Troubleshooting:** If the console ever complains about missing Emscripten FS helpers (for example, `FS_analyzePath`), make sure you‚Äôre running the latest `main.js` and hard-refresh the page so the new mounting logic is picked up. Serving the demo over HTTP (see ‚ÄúLocal preview‚Äù above) is still recommended.

## üéô Speaker catalog

The curated array now tracks which model each speaker belongs to. English speakers still point at the embedded **LibriTTS-R (medium)** voice bank, while Swedish speakers use their local VITS directories:

```js
window.SHERPA_TTS_SPEAKERS = [
  { id: 0, modelId: "en-libritts", name: "LibriTTS-R Speaker 3922", language: "English (US)" },
  { id: 57, modelId: "en-libritts", name: "LibriTTS-R Speaker 2592", language: "English (US)" },
  { id: 0, modelId: "sv-lisa", name: "Lisa (medium)", language: "Swedish" },
  { id: 0, modelId: "sv-nst", name: "NST (medium)", language: "Swedish" }
  // ‚Ä¶see index.html for the full curated list
];
```

Each entry records the sherpa-onnx speaker ID together with any available dataset metadata so you can jump straight to the matching samples (for example, [LibriTTS-R Speaker 3922](https://k2-fsa.github.io/sherpa/onnx/tts/all/English/vits-piper-en_US-libritts_r-medium.html#speaker-3922) or the [Swedish Lisa model card](https://k2-fsa.github.io/sherpa/onnx/tts/all/Swedish/vits-piper-sv_SE-lisa-medium.html)).

If you need a different subset (or additional languages), update the array above **before** `main.js` runs. Any missing IDs automatically fall back to `Voice #{id}`, so it‚Äôs safe to gradually expand the catalog as you explore the upstream docs. The per-language index at [https://k2-fsa.github.io/sherpa/onnx/tts/all/](https://k2-fsa.github.io/sherpa/onnx/tts/all/) is a great starting point when hunting for new models.

## ‚öñÔ∏è License

This demo inherits the repo MIT license. The bundled sherpa-onnx artifacts follow their upstream license.
